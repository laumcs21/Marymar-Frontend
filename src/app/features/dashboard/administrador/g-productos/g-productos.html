<section class="flex-1 p-10 overflow-y-auto">
<div class="max-w-6xl mx-auto">

  <!-- HEADER -->
  <div class="mb-10 flex justify-between items-start">

    <div>
      <h2 class="text-2xl font-bold text-primary">
        Gestión de Productos
      </h2>
      <p class="text-slate-500 text-sm">
        Administra los productos del menú
      </p>
    </div>

    <button
    (click)="abrirModalCrear()"
    class="bg-accent text-white px-5 py-2.5 rounded-lg text-sm font-bold flex items-center gap-2 hover:opacity-90 transition">

    <span class="material-symbols-outlined">add</span>
    Nuevo Producto
    </button>

  </div>

    <!-- BUSCADOR -->
    <div class="mb-6">
    <div class="relative max-w-md">
        
        <span class="material-symbols-outlined 
                    absolute left-3 top-1/2 -translate-y-1/2 
                    text-slate-400">
        search
        </span>

        <input
        type="text"
        [(ngModel)]="terminoBusqueda"
        (input)="buscarProductos()"
        placeholder="Buscar producto por nombre..."
        class="w-full h-11 pl-10 pr-4 rounded-lg 
                border border-slate-200 
                focus:ring-2 focus:ring-primary 
                focus:border-primary
                text-sm" />
    </div>
</div>
  <!-- FILTROS POR CATEGORÍA -->
  <div class="flex gap-2 overflow-x-auto mb-8">
    <button
      (click)="filtrarPorCategoria(null)"
      [class.bg-primary]="!categoriaSeleccionada"
      [class.text-white]="!categoriaSeleccionada"
      class="px-4 py-1.5 rounded-full bg-slate-100 text-sm font-medium whitespace-nowrap">

      Todos
    </button>

    <button
      *ngFor="let cat of categorias"
      (click)="filtrarPorCategoria(cat.id)"
      [class.bg-primary]="categoriaSeleccionada === cat.id"
      [class.text-white]="categoriaSeleccionada === cat.id"
      class="px-4 py-1.5 rounded-full bg-slate-100 text-sm font-medium whitespace-nowrap">

      {{ cat.nombre }}
    </button>

  </div>

  <!-- GRID DE PRODUCTOS -->
  <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 ">

    <div *ngFor="let prod of productos"
         class="bg-white rounded-xl border border-slate-200 overflow-hidden shadow-sm hover:shadow-md transition-shadow">

      <div class="h-48 bg-slate-200 bg-cover bg-center"
        [style.backgroundImage]="'url(' + (prod.imagenPrincipal || 'assets/no-image.png') + ')'">
      </div>

      <div class="p-4">

        <div class="flex justify-between items-start mb-2">
          <h4 class="font-bold text-lg">{{ prod.nombre }}</h4>
          <span class="text-primary font-bold">
            ${{ prod.precio }}
          </span>
        </div>

        <p class="text-sm text-slate-500 line-clamp-2 mb-4">
          {{ prod.descripcion }}
        </p>

        <div class="flex items-center justify-between">

          <span
            [ngClass]="prod.activo ? 
              'bg-green-100 text-green-700' : 
              'bg-slate-100 text-slate-600'"
            class="px-2.5 py-1 rounded-full text-xs font-semibold">

            {{ prod.activo ? 'Disponible' : 'No Disponible' }}
          </span>

          <div class="flex gap-2">

            <button
              (click)="editarProducto(prod)"
              class="p-2 text-slate-400 hover:text-primary transition-colors">

              <span class="material-symbols-outlined">edit</span>
            </button>

        <!-- Desactivar -->
        <button
            (click)="toggleDisponibilidad(prod)"
            class="p-2 text-slate-400 hover:text-amber-500 transition-colors">
            <span class="material-symbols-outlined">
            {{ prod.activo ? 'visibility_off' : 'visibility' }}
            </span>
        </button>

        <!-- Eliminar Permanente -->
        <button
            (click)="eliminarDefinitivo(prod.id)"
            class="p-2 text-slate-400 hover:text-red-500 transition-colors">
            <span class="material-symbols-outlined">delete</span>
        </button>


          </div>

        </div>

      </div>

    </div>

  </div>

</div>
<!-- MODAL CREAR / EDITAR PRODUCTO -->
<div *ngIf="mostrarModal"
     class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">

  <div class="bg-white rounded-xl w-full max-w-2xl shadow-2xl border border-slate-200 overflow-hidden">

    <!-- HEADER -->
    <div class="px-8 py-6 border-b border-slate-200 flex justify-between items-center bg-slate-50">
      <div>
        <h3 class="text-xl font-bold text-primary">
          {{ modoEdicion ? 'Editar Producto' : 'Nuevo Producto' }}
        </h3>
        <p class="text-slate-500 text-sm">
          {{ modoEdicion ? 'Actualiza la información del producto' : 'Crea un nuevo producto para el menú' }}
        </p>
      </div>

      <button (click)="cerrarModal()"
              class="text-slate-400 hover:text-primary transition-colors">
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>

    <!-- BODY -->
    <div class="p-8 max-h-[75vh] overflow-y-auto">

      <form [formGroup]="form"
            (ngSubmit)="guardar()"
            class="grid grid-cols-1 md:grid-cols-2 gap-6">

        <!-- NOMBRE -->
        <div class="md:col-span-2">
          <label class="block text-sm font-semibold text-primary mb-2">
            Nombre del Producto
          </label>
          <input formControlName="nombre"
                 class="w-full h-12 px-4 rounded-lg border border-slate-200 focus:ring-2 focus:ring-primary focus:border-primary"
                 placeholder="Ej. Ceviche Mixto Especial" />

          <div *ngIf="form.get('nombre')?.touched && form.get('nombre')?.invalid"
               class="text-red-500 text-xs mt-1">
            Campo obligatorio
          </div>
        </div>

        <!-- DESCRIPCIÓN -->
        <div class="md:col-span-2">
        <label class="block text-sm font-semibold text-primary mb-2">
            Descripción
        </label>

        <textarea
            formControlName="descripcion"
            rows="3"
            class="w-full p-4 rounded-lg border border-slate-200 focus:ring-2 focus:ring-primary focus:border-primary resize-none"
            placeholder="Describe los ingredientes y preparación...">
        </textarea>

        <div *ngIf="form.get('descripcion')?.touched && form.get('descripcion')?.invalid"
            class="text-red-500 text-xs mt-1">
            Descripción obligatoria
        </div>
        </div>

        <!-- CATEGORIA -->
        <div>
          <label class="block text-sm font-semibold text-primary mb-2">
            Categoría
          </label>

          <select formControlName="categoriaId"
                  class="w-full h-12 px-4 rounded-lg border border-slate-200 focus:ring-2 focus:ring-primary focus:border-primary">
            <option [ngValue]="null">Seleccione categoría</option>
            <option *ngFor="let cat of categorias" [ngValue]="cat.id">
              {{ cat.nombre }}
            </option>
          </select>

          <div *ngIf="form.get('categoriaId')?.touched && form.get('categoriaId')?.invalid"
               class="text-red-500 text-xs mt-1">
            Categoría obligatoria
          </div>
        </div>

        <!-- PRECIO -->
        <div>
          <label class="block text-sm font-semibold text-primary mb-2">
            Precio
          </label>

          <div class="relative">
            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">$</span>
            <input formControlName="precio"
                   type="number"
                   step="0.01"
                   class="w-full h-12 pl-8 pr-4 rounded-lg border border-slate-200 focus:ring-2 focus:ring-primary focus:border-primary"
                   placeholder="0.00" />
          </div>

          <div *ngIf="form.get('precio')?.touched && form.get('precio')?.invalid"
               class="text-red-500 text-xs mt-1">
            Precio válido obligatorio
          </div>
        </div>

                <!-- IMAGEN -->
        <div class="md:col-span-2">
        <label class="block text-sm font-semibold text-primary mb-2">
            Imagen del Producto
        </label>

        <div
            class="border-2 border-dashed border-slate-300 rounded-lg p-6 text-center cursor-pointer hover:border-primary transition"
            (click)="fileInput.click()">

            <span class="material-symbols-outlined text-3xl text-primary mb-2 block">
            cloud_upload
            </span>

            <p class="text-sm text-slate-500">
            Haz clic para subir imagen
            </p>
        </div>

        <input
            #fileInput
            type="file"
            accept="image/*"
            multiple
            class="hidden"
            (change)="onFileSelected($event)" />

        <!-- PREVIEW -->
<div *ngIf="previews.length"
     class="mt-4 flex gap-3 flex-wrap">

  <div *ngFor="let img of previews; let i = index"
       class="relative">

    <img [src]="img"
         class="h-24 w-24 rounded-lg border object-cover" />

            <button
            type="button"
            (click)="previews.splice(i,1); imagenesSeleccionadas.splice(i,1)"
            class="absolute -top-2 -right-2 
                    bg-red-500 text-white 
                    rounded-full w-5 h-5 text-xs">
            ✕
            </button>

        </div>

        </div>
        </div>

        <!-- FOOTER -->
        <div class="md:col-span-2 flex justify-end gap-3 pt-4">

          <button type="button"
                  (click)="cerrarModal()"
                  class="px-6 py-2.5 rounded-lg border border-slate-300 text-slate-600 font-bold hover:bg-slate-100 transition">
            Cancelar
          </button>

          <button type="submit"
                  [disabled]="form.invalid"
                  class="px-6 py-2.5 rounded-lg bg-primary text-white font-bold hover:bg-primary/90 shadow-md transition disabled:opacity-50">
            {{ modoEdicion ? 'Guardar Cambios' : 'Guardar Producto' }}
          </button>

        </div>

      </form>

    </div>

  </div>

</div>
</section>